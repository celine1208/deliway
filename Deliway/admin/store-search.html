<?php
session_start();

include "../config/db.php";

$search = $_POST['search'];
$searchstring = $_POST['searchstring'];

$sql = "SELECT * FROM store WHERE $search like '%$searchstring%'";
echo $sql;
$result = mysqli_query($con,$sql);
if (!$result) {
    echo "쿼리 오류: " . mysqli_error($con);
}
$row_num = mysqli_num_rows($result);f

?>
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>식당 관리 - 맛집 플랫폼 관리자</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/manager-common.css">
    <link rel="stylesheet" href="./css/manager-store.css">
    <script src="./js/manager-common.js" defer></script>
</head>

<body>
    <aside class="sidebar">
        <div class="logo">맛집관리</div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="./manager-dashboard.html" class="nav-link">
                    <i class="fas fa-home"></i>
                    <span>대시보드</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="./manager-store.html" class="nav-link">
                    <i class="fas fa-utensils"></i>
                    <span>식당 관리</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="./manager-user.html" class="nav-link">
                    <i class="fas fa-users"></i>
                    <span>회원 관리</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="./manager-review.html" class="nav-link">
                    <i class="fas fa-star"></i>
                    <span>리뷰 관리</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="./manager-statistics.html" class="nav-link">
                    <i class="fas fa-chart-bar"></i>
                    <span>통계</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="./manager-setting.html" class="nav-link">
                    <i class="fas fa-cog"></i>
                    <span>설정</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- 메인 컨텐츠 -->
    <div class="main-content">
        <!-- 검색/필터 섹션 -->
        <div class="search-section">
            <form method="POST" action="store_search.html" class="search-form">
                <div class="form-group">
                    <label for="search">필터</label>
                    <select name="search" id="search">
                        <option value="" disabled selected>필터 선택</option>
                        <option value="store_name">업체명으로 찾기</option>
                        <option value="store_call">매장 연락처로 찾기</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="search">검색어 입력</label>
                    <input type="text" name="searchstring">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i>검색</button>
                </div>
            </form>
        </div>

        <!-- 식당 목록 테이블 -->
        <div class="restaurant-table">
            <div class="table-header">
                <h2>식당 목록</h2>
                <div class="btn-group">
                    <button class="btn btn-secondary">
                        <i class="fas fa-download"></i>
                        엑셀 다운로드
                    </button>
                    <button class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        새 식당 등록
                    </button>
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>
                            <input type="checkbox">
                        </th>
                        <th>식당명</th>
                        <th>카테고리</th>
                        <th>주소</th>
                        <th>연락처</th>
                        <th>등록일</th>
                        <th>상태</th>
                    </tr>
                </thead>
                <tbody>
                    <?php
                    if($row_num == ""){
                    ?>
                    <tr>
                        <td>등록된 업체정보가 없습니다.</td>
                        <td><?php echo $row['store_name'] ?></td>
                        <td><?php echo $row['store_category'] ?></td>
                        <td><?php echo $row['store_address1'] ?></td>
                        <td><?php echo $row['store_call'] ?></td>
                        <td><?php echo $row['store_wdate'] ?></td>
                        <td><?php echo $row['store_ing'] ?></td>
                    </tr>
                    <tr>
                    <?php
                    } else {

                        $sql1 = "SELECT * FROM store WHERE $search like '%$searchstring%' ORDER BY store_idx DESC"; //등록된 정보의 최근 글 부터
                        $result1 = mysqli_query($con,$sql1);
                        while($row1 = mysqli_fetch_array($result1)){;

                        ?>
                    </tr>
                    <tr>
                        <td>
                            <input type="checkbox">
                        </td>
                        <td><a href="store_detail.html?store_idx=<?php echo $row1['store_idx'];?>"><?php echo $row1['store_name'];?></a></td>
                        <td><?php
                            if ($row1['store_category'] == '1') { echo '한식'; }
                            else if ($row1['store_category'] == '2') { echo '중식'; }
                            else if ($row1['store_category'] == '3') { echo '양식'; }
                            else if ($row1['store_category'] == '4') { echo '일식'; }
                            else if ($row1['store_category'] == '5') { echo '카페&디저트'; }
                            else if ($row1['store_category'] == '6') { echo '채식'; }
                            else if ($row1['store_category'] == '7') { echo '뷔페'; }
                            else if ($row1['store_category'] == '8') { echo '오마카세'; }
                        ?></td>
                        <td><?php echo mb_substr($row1['store_address1'],0,6);?></td>
                        <td><?php echo $row1['store_call'];?></td>
                        <td><?php echo $row1['store_wdate'];?></td>
                        <td><a href="store_ok.html?store_idx=<?php echo $row1['store_idx'];?>&user_id=<?php echo $row1['user_id'];?>"><?php echo $row1['store_ing'];?></a></td>
                        <td>
                            <button class="btn btn-primary">수정</button>
                            <button class="btn btn-danger">삭제</button>
                        </td>
                    </tr>
                    <?php } ?>
                    <?php } ?>
                </tbody>
            </table>

            <!-- 페이지네이션 -->
            <div class="pagination">
                <button class="page-btn"><i class="fas fa-angle-double-left"></i></button>
                <button class="page-btn"><i class="fas fa-angle-left"></i></button>
                <button class="page-btn active">1</button>
                <button class="page-btn">2</button>
                <button class="page-btn">3</button>
                <button class="page-btn">4</button>
                <button class="page-btn">5</button>
                <button class="page-btn"><i class="fas fa-angle-right"></i></button>
                <button class="page-btn"><i class="fas fa-angle-double-right"></i></button>
            </div>
        </div>
    </div>
</body>

</html>